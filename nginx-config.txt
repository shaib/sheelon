# Main server configuration

# user www-data;
worker_processes auto;
worker_cpu_affinity auto;
pid /tmp/nginx.pid;
error_log ./log/nginx-error.log;
# include /etc/nginx/modules-enabled/*.conf;


events {
        worker_connections 768;
        # multi_accept on;
}

http {
server {
    # Listen on port 3000
    listen 3000;
    listen [::]:3000;
    
    # Server name (replace with your domain)
    server_name localhost;
    
    # Access and error logs
    access_log ./log/proxy_access.log;
    error_log ./log/proxy_error.log;

    # Root location configuration
    location ^~/-/static/ {
        proxy_pass http://localhost:8001/-/static/;
    }
    location ^~/-/static-plugins/ {
        proxy_pass http://localhost:8001/-/static-plugins/;
    }
    location ^~/-/dashboards {
        # Proxy settings - note the /abc/ path at the end
        proxy_pass http://localhost:8001/-/dashboards;
        
        # Forward the original host header
        proxy_set_header Host $host;
        
        # Forward the real IP and protocol
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Timeouts
        proxy_connect_timeout 60;
        proxy_send_timeout 60;
        proxy_read_timeout 60;
        
        # Buffer settings
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 4 32k;
        proxy_busy_buffers_size 64k;
        
        # Preserve query string parameters
        # proxy_pass_request_params on;
    }
    location / {
        return 301 $scheme://$host:3000/-/dashboards;
    }
}
}
